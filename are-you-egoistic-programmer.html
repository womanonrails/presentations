<!doctype html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no'>

    <title>Are you an Egoistic Programmer?</title>
    <meta name='description' content='Clean code in practice'>

    <link rel='stylesheet' href='css/reset.css'>
    <link rel='stylesheet' href='css/reveal.css'>
    <link rel='stylesheet' href='css/theme/fractalsoft_white.css' id='theme'>

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class='reveal'>
      <div class='slides'>

<section data-transition='slide-in slide-out'>
  <h1>Are you an Egoistic Programmer?</h1>
  <!-- <h4>Clean code in practice</h4> -->
  <p>
    <a href='https://womanonrails.com' target='_blank' title='Web development from woman perspective'>Agnieszka Małaszkiewicz</a> at <a href='https://fractalsoft.org' target='_blank' title='Ruby on Rails developers'>Fractal Soft</a>
  </p>

  <a class='theme-box'
     id='theme-black'
     href="#"
     onclick="document.getElementById('theme').setAttribute('href','css/theme/fractalsoft_black.css'); return false;"></a>
  <a class='theme-box'
     id='theme-white'
     href="#"
     onclick="document.getElementById('theme').setAttribute('href','css/theme/fractalsoft_white.css'); return false;"></a>

  <aside class='notes' data-markdown>
- projekty legacy
- proste techniki polepszania kodu w praktyce
  </aside>
</section>

<section data-background='images/egoistic-programmer/farm.jpg'
         data-markdown>
Notes:
- Agnieszka Małaszkiewicz
- nowe technologie w rolnictwie
- 8 lat doświadczenia
- team leader, mentor
- współwłaściciel firmy Fractal Soft
- zainteresowania: good code standard, refactoring, testing
</section>

<section data-background='images/shared/ruby.jpg'
         data-markdown>
Notes:
- większość przykładów w Ruby
- pracuje i lubię ten język
</section>

<section data-background='images/quality-assurance/help.jpg'
         data-markdown>
Notes:
- projekt w kiepskiej sytuacji
- nic nie pasuje do niczego
- pojawia się strach
- wołamy o pomoc
</section>

<section data-markdown
         data-transition='slide-in fade-out'>
## What did we wrong?

Notes:
- co poszło nie tak?
- przerzucamy się winą
- To wina technologii - nie jest dostosowana do potrzeb
- To wina klienta - naciska tylko na nowe funkcjonalności
- nie mogłem inaczej
</section>

<section data-background='images/egoistic-programmer/camp.jpg'
         data-markdown>
Notes:
- zamiast obwiniać się to dbać
- być jak skauci / harcerze
- pozostaw miejsce obozowania czystsze niż było
- wchodzisz do pliku z kodem i zostawiasz go czystszym, lepszym
</section>

<section data-transition='slide-in fade-out'>
  <h2 class='font-size-like-h1'>Poker - refactoring</h2>
  <img src='./images/egoistic-programmer/poker.jpg' alt='Poker' class='pure'>

  <aside class='notes' data-markdown>
- zaczniemy od przykładu
- kod napisany kiedyś przez juniora
- pokerowa ręka
- opieramy się na testach testy
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <div class='small-size left-side-column'
       data-markdown>
```ruby
module Poker
  # Poker hand
  class Hand
    def check(array)
      array.sort!
      return 9 if straight_flush?(array)
      return 8 if four_of_a_kind?(array)
      return 7 if full_house?(array)
      return 6 if flush?(array)
      return 3 if two_pair?(array)
      return 2 if one_pair?(array)
      return 4 if three_of_a_kind?(array)
      return 5 if straight?(array)
      return 1 if high_card?(array)
      return 0
    end

    #Jeśli układ jest pokerem, numery kart modulo 4 są sobie równe
    def straight_flush?(array)
      if straight?(array) and flush?(array)
        return true
      else
        return false
      end
    end

    #jeśli mamy karetę, jeśli podzielę numery kart przez 4
    #4 pierwsze lub 4 ostatnie powinny być sobie równe
    def four_of_a_kind?(array)
      tmp = array.clone
      tmp.collect!{|x| x / 4 }

      helper_array = [0] * 13

      tmp.each do |elem|
        helper_array[elem] += 1
      end

      helper_array.delete(0)

      if helper_array.include?(4) and helper_array.include?(1)
        return true
      else
        return false
      end
    end

    def full_house?(array)
      tmp = array.clone
      tmp.collect!{|x| x / 4 }

      helper_array = [0] * 13

      tmp.each do |elem|
        helper_array[elem] += 1
      end

      helper_array.delete(0)

      if helper_array.include?(3) and helper_array.include?(2)
        return true
      else
        return false
      end
    end

    def flush?(array)
      tmp = array.clone
      tmp.collect!{|x| x % 4 }

      if tmp.uniq.length == 1
        return true
      else
        return false
      end
    end

    def straight?(array)
      if array.last / 4 == 12
        return straight_with_ace?(array)
      else
        return true_straight?(array)
      end
    end
```
  </div>

  <div data-markdown class='small-size middle-side-column' style="margin-left: 5%;">
```ruby
    def straight_with_ace?(array)
      if true_straight?(array)
        return true
      else
        tmp = array.clone
        tmp.collect!{|x| x / 4}
        tmp.delete(12)

        sum = 0;
        tmp.each do |num|
          sum += num
        end

        if sum == 6
          return true
        else
          return false
        end
      end
    end

    def true_straight?(array)
      tmp = array.clone
      minimum_card = tmp[0] / 4

      tmp.collect!{|x| x / 4 - minimum_card}

      sum = 0;
      tmp.each do |num|
        sum += num
      end

      if sum == 10
        return true
      else
        return false
      end
    end

    def three_of_a_kind?(array)
      tmp = array.clone
      tmp.collect!{|x| x / 4 }

      helper_array = [0] * 13

      tmp.each do |elem|
        helper_array[elem] += 1
      end

      helper_array.delete(0)

      if helper_array.include?(3) and helper_array.include?(1)
        return true
      else
        return false
      end
    end

    def two_pair?(array)
      tmp = array.clone
      tmp.collect!{|x| x / 4 }

      helper_array = [0] * 13

      tmp.each do |elem|
        helper_array[elem] += 1
      end

      helper_array.delete(0)

      if helper_array.include?(2) and helper_array.length == 3
        return true
      else
        return false
      end
    end
```
  </div>

  <div data-markdown class='small-size right-side-column'>
```ruby
    def one_pair?(array)
      tmp = array.clone
      tmp.collect!{|x| x / 4 }

    #  (0..8).each do |elem|
    #    tmp.delete(elem)
    #  end

      helper_array = [0] * 13

      tmp.each do |elem|
        helper_array[elem] += 1
      end

      helper_array.delete(0)

      if helper_array.include?(2)
        return true
      else
        return false
      end
    end

    def high_card?(array)
      if array.last >= 36
        return true
      else
        return false
      end
    end
  end
end
```
[All code is here](https://github.com/womanonrails/poker/blob/55c9ae0ab921f7aa95bb7e47676d87b970a32033/lib/poker/hand.rb)
  </div>

  <aside class='notes' data-markdown>
- całość kodu
- nie do przeczytania
- dostępny cały kod na GitHubie
- 2.5 ekranu
- artykuł szczegółowy na temat tego kodu
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <h2>Stats</h2>
  <ul>
    <li>LOC - 194</li>
    <li>LOT - 168</li>
    <li>Flog - 112.8</li>
    <li>Flay - 123</li>
    <li>Tests - 12 examples, 0 failures</li>
  </ul>

  <aside class='notes' data-markdown>
- LOC & LOT - linie kodu, linie testów
- Flog & Flay - miary złożoności kodu
- powyżej 20-25 - (dla metody) może potrzebować refaktoringu
- powyżej 60 - (dla metody) niebezpieczne, very complex
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <div class='left-column code-font'>
    <h2>First stats</h2>
    <ul>
      <li>LOC - <span class='highlight-red'>194</span></li>
      <li>LOT - <span class='highlight-red'>168</span></li>
      <li>Flog - <span class='highlight-red'>112.8</span></li>
      <li>Flay - <span class='highlight-red'>123</span></li>
      <li>Tests - 12 examples, 0 failures</li>
    </ul>
  </div>

  <div class='right-column code-font'>
    <h2>Last stats</h2>
    <ul>
      <li>LOC - <span class='highlight-green'>37</span></li>
      <li>LOT - <span class='highlight-green'>173</span></li>
      <li>Flog - <span class='highlight-green'>28.0</span></li>
      <li>Flay - <span class='highlight-green'>0</span></li>
      <li>Tests - 145 examples, 0 failures</li>
    </ul>
  </div>

  <aside class='notes' data-markdown>
- łatwość w utrzymaniu 40 linijek kodu
- jak do tego dojść?
  </aside>
</section>


<section data-transition='slide-in fade-out'>
  <h2 class='font-size-like-h1'>Step 1 - Linter cleanups</h2>
  <img src='./images/egoistic-programmer/cleanups.jpg' alt='Cleanups' class='pure'>

  <aside class='notes' data-markdown>
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <div data-markdown>
## Step 1 - Linter cleanups

#### Code before change:

```ruby
def straight_flush?(array)
  if straight?(array) and flush?(array)
    return true
  else
    return false
  end
end
```
  </div>

  <div class='fragment' data-fragment-index='1'>
    <div data-markdown>
#### Code after change:

```ruby
def straight_flush?(array)
  straight?(array) && flush?(array)
end
```
    </div>
  </div>

  <aside class='notes' data-markdown>
- w Ruby nie trzeba pisać `return`
- same te metody zwracają `true` lub `false`
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <h2 class='font-size-like-h1'>Step 2 - Simplify logic</h2>
  <img src='./images/egoistic-programmer/logic.jpg' alt='Logic' class='pure'>

  <aside class='notes' data-markdown>
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <div data-markdown class='middle-size'>
## Step 2 - Simplify logic

#### Code before change:

```ruby
def one_pair?(array)
  tmp = array.clone
  tmp.collect!{|x| x / 4 }

#  (0..8).each do |elem|
#    tmp.delete(elem)
#  end

  helper_array = [0] * 13

  tmp.each do |elem|
    helper_array[elem] += 1
  end

  helper_array.delete(0)

  helper_array.include?(2)
end
```
  </div>

  <aside class='notes' data-markdown>
- dużo się dzieje
- jakieś komentarze
- usuwamy content
- bazując na testach piszemy jeszcze raz
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <div data-markdown>
## Step 2 - Simplify logic

#### Code after:

```ruby
def one_pair?(array)
  hash = Hash.new(0)
  array.each { |item| hash[item / 4] += 1 }
  hash.values.include?(2)
end
```
  </div>

  <aside class='notes' data-markdown>
Repeat:
1. Took method and remove content
2. Run test (some tests are failing), understand logic
3. Write new code in simpler way
4. Check tests
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <div class='left-column code-font'>
    <h2>Old stats</h2>
    <ul>
      <li>LOC - <span class='highlight-red'>194</span></li>
      <li>LOT - <span class='highlight-red'>168</span></li>
      <li>Flog - <span class='highlight-red'>112.8</span></li>
      <li>Flay - <span class='highlight-red'>123</span></li>
      <li>Tests - 12 examples, 0 failures</li>
    </ul>
  </div>

  <div class='right-column code-font'>
    <h2>New stats</h2>
    <ul>
      <li>LOC - <span class='highlight-green'>73</span></li>
      <li>LOT - <span class='highlight-green'>170</span></li>
      <li>Flog - <span class='highlight-green'>76.3</span></li>
      <li>Flay - <span class='highlight-green'>63</span></li>
      <li>Tests - 12 examples, 0 failures</li>
    </ul>
  </div>

  <aside class='notes' data-markdown>
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <h2 class='font-size-like-h1'>Step 3 - From procedural to more OOP</h2>
  <img src='./images/egoistic-programmer/oop.jpg' alt='OOP' class='pure'>

  <aside class='notes' data-markdown>
  </aside>
</section>

<section data-markdown
         data-transition='slide-in fade-out'>
## Step 3 - From procedural to more OOP

#### Array everywhere

```ruby
def three_of_a_kind?(array)
  hash = Hash.new(0)
  array.each { |item| hash[item / 4] += 1 }
  hash.values.include?(3)
end
```

Notes:
- w każdej metodzie tak samo
- `array` argument
- przekazujemy stan
</section>

<section data-transition='slide-in fade-out'>
  <div data-markdown>
#### Add initializer

```ruby
def initialize(array)
  @array = array.sort
  @cards = @array.map { |item| item / 4 }
end
```
  </div>

  <div data-markdown class='fragment fade-in-then-semi-out' data-fragment-index='1'>
#### Before
```ruby
def three_of_a_kind?(array)
  hash = Hash.new(0)
  array.each { |item| hash[item / 4] += 1 }
  hash.values.include?(3)
end
```
  </div>

  <div data-markdown class='fragment' data-fragment-index='2'>
#### After
```ruby
def three_of_a_kind?
  hash = Hash.new(0)
  @cards.each { |item| hash[item] += 1 }
  hash.values.include?(3)
end
```
  </div>

  <aside class='notes' data-markdown>
- we add initializer
- cards normalization
- remove argument from all methods
- remove duplication
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <div data-markdown class='small-size'>
```ruby
class Hand
  def initialize(array)
    @array = array.sort
    @carts = @array.map { |item| item / 4 }
  end

  def check
    return 9 if straight_flush?
    return 8 if four_of_a_kind?
    return 7 if full_house?
    return 6 if flush?
    return 5 if straight?
    return 4 if three_of_a_kind?
    return 3 if two_pair?
    return 2 if one_pair?
    return 1 if high_card?
    return 0
  end

  def straight_flush?
    straight? && flush?
  end

  def four_of_a_kind?
    hash = Hash.new(0)
    @carts.each { |item| hash[item] += 1 }
    hash.values.include?(4)
  end

  def full_house?
    three_of_a_kind? && one_pair?
  end

  def flush?
    color = @array.map { |item| item % 4 }
    color.uniq.size == 1
  end

  def normal_straight?
    @carts.each_cons(2) do |previous, current|
      return false unless previous + 1 == current
    end
    true
  end

  def straight?
    [0, 1, 2, 3, 12] == @carts || normal_straight?
  end

  def three_of_a_kind?
    hash = Hash.new(0)
    @carts.each { |item| hash[item] += 1 }
    hash.values.include?(3)
  end

  def two_pair?
    hash = Hash.new(0)
    @carts.each { |item| hash[item] += 1 }
    (hash.values - [2]).size == 1
  end

  def one_pair?
    hash = Hash.new(0)
    @carts.each { |item| hash[item] += 1 }
    hash.values.include?(2)
  end

  def high_card?
    @array.last >= 36
  end
end
```
  </div>

  <aside class='notes' data-markdown>
- kod mieści się na jednym ekranie
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <h5>before stats...</h5>
  <h2 class='fragment' data-fragment-index='1'>Changes in Tests</h2>
  <aside class='notes' data-markdown>
- 12 testów - wiele asercji
- 1 test - 1 asercja
- łatwiej śledzić zmiany / błędy w kodzie
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <div class='left-column code-font'>
    <h2>Old stats</h2>
    <ul>
      <li>LOC - <span class='highlight-green'>73</span></li>
      <li>LOT - <span class='highlight-red'>170</span></li>
      <li>Flog - <span class='highlight-red'>76.3</span></li>
      <li>Flay - <span class='highlight-red'>63</span></li>
      <li>Tests - 12 examples, 0 failures</li>
    </ul>
  </div>

  <div class='right-column code-font'>
    <h2>New stats</h2>
    <ul>
      <li>LOC - <span class='highlight-red'>76</span></li>
      <li>LOT - <span class='highlight-green'>190</span></li>
      <li>Flog - <span class='highlight-green'>70.9</span></li>
      <li>Flay - <span class='highlight-green'>57</span></li>
      <li>Tests - 104 examples, 0 failures</li>
    </ul>
  </div>

  <aside class='notes' data-markdown>
- więcej kodu - dodany konstruktor
- mniej powtarzania - mniej skomplikowania
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <h2 class='font-size-like-h1'>Step 4 - Remove duplication</h2>
  <img src='./images/egoistic-programmer/cleanups2.jpg' alt='Cleanups' class='pure'>

  <aside class='notes' data-markdown>
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <div data-markdown>
## Step 4 - Remove duplication

```ruby
def three_of_a_kind?
  hash = Hash.new(0)
  @cards.each { |item| hash[item] += 1 }
  hash.values.include?(3)
end
```
  </div>

  <aside class='notes' data-markdown>
- wielokrotnie liczymy ilość tych samych figur w ręce
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <div data-markdown>
## Step 4 - Remove duplication

#### Change initializer

```ruby
def initialize(array)
  @array = array.sort
  @cards = @array.map { |item| item / 4 }
  @frequency = cards_frequency
end
```
  </div>

  <div class='fragment'
       data-fragment-index='1'
       data-markdown>
#### New method

```ruby
def cards_frequency
  hash = Hash.new(0)
  @cards.each { |item| hash[item] += 1 }
  hash.values
end
```
  </div>

  <aside class='notes'
         data-markdown>
- liczymy ilość figur w konstruktorze (initializer)
- usuwamy duplikację
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <div data-markdown>
## Step 4 - Remove duplication

#### Before

```ruby
def four_of_a_kind?
  hash = Hash.new(0)
  @cards.each { |item| hash[item] += 1 }
  hash.values.include?(4)
end
```
  </div>

  <div class='fragment'
       data-fragment-index='1'
       data-markdown>
#### After

```ruby
def four_of_a_kind?
  @frequency.include?(4)
end
```
  </div>

  <aside class='notes' data-markdown>
- sprawdzamy tylko ilość wystąpień
- nie musimy tego liczyć
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <div class='left-column code-font'>
    <h2>Old stats</h2>
    <ul>
      <li>LOC - <span class='highlight-red'>76</span></li>
      <li>LOT - 190</li>
      <li>Flog - <span class='highlight-red'>70.9</span></li>
      <li>Flay - <span class='highlight-red'>57</span></li>
      <li>Tests - 104 examples, 0 failures</li>
    </ul>
  </div>

  <div class='right-column code-font'>
    <h2>New stats</h2>
    <ul>
      <li>LOC - <span class='highlight-green'>75</span></li>
      <li>LOT - 190</li>
      <li>Flog - <span class='highlight-green'>59.9</span></li>
      <li>Flay - <span class='highlight-green'>0</span></li>
      <li>Tests - 104 examples, 0 failures</li>
    </ul>
  </div>

  <aside class='notes' data-markdown>
- zmniejszona złożoność
- mniej duplikacji
- flay = 0
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <h2 class='font-size-like-h1'>Step 5 - small public interface</h2>
  <img src='./images/egoistic-programmer/exhibitionism.jpg' alt='Exhibitionism' class='pure'>

  <aside class='notes' data-markdown>
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <!-- <h2>Step 5 - small public interface</h2> -->

  <div class='small-size'
       data-markdown>
```ruby
class Hand
  def initialize(array)
    @array = array.sort
    @cards = @array.map { |item| item / 4 }
    @frequency = cards_frequency
  end

  def cards_frequency
    hash = Hash.new(0)
    @cards.each { |item| hash[item] += 1 }
    hash.values
  end

  def check
    return 9 if straight_flush?
    return 8 if four_of_a_kind?
    return 7 if full_house?
    return 6 if flush?
    return 5 if straight?
    return 4 if three_of_a_kind?
    return 3 if two_pair?
    return 2 if one_pair?
    return 1 if high_card?
    return 0
  end

  def straight_flush?
    straight? && flush?
  end

  def four_of_a_kind?
    @frequency.include?(4)
  end

  def full_house?
    three_of_a_kind? && one_pair?
  end

  def flush?
    color = @array.map { |item| item % 4 }
    color.uniq.size == 1
  end

  def normal_straight?
    @cards.each_cons(2) do |previous, current|
      return false unless previous + 1 == current
    end
    true
  end

  def straight?
    [0, 1, 2, 3, 12] == @cards || normal_straight?
  end

  def three_of_a_kind?
    @frequency.include?(3)
  end

  def two_pair?
    (@frequency - [2]).size == 1
  end

  def one_pair?
    @frequency.include?(2)
  end

  def high_card?
    @array.last >= 36
  end
end
```
  </div>

  <aside class='notes'>
- wszystkie metody są publiczne
- czy muszą być?
- nie - popatrzmy na testy
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <div class='middle-size'
       data-markdown>
## Step 5 - small public interface

```ruby
[
  [0, 4, 8, 12, 16],
  [5, 9, 13, 17, 21],
  [10, 14, 18, 22, 26],
  [15, 19, 23, 27, 31],
  [16, 20, 24, 28, 32],
  [37, 29, 33, 21, 25].shuffle,
  [30, 34, 38, 26, 42].shuffle,
  [31, 35, 47, 43, 39].shuffle,
  [32, 48, 40, 44, 36].shuffle,
  [49, 45, 41, 37, 33].shuffle
].each do |cards|
  it "detects straight_flush for #{cards}" do
    hand = described_class.new(cards)
    expect(hand.check).to eq 9
  end
end
```
  </div>

  <aside class='notes'
         data-markdown>
- big public interface is hard to maintain
- less confusion
- do not allow to unexpected behavior
- test are checking only method `check`
- all others method as private
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <div class='left-column code-font'>
    <h2>Old stats</h2>
    <ul>
      <li>LOC - <span class='highlight-green'>75</span></li>
      <li>LOT - 190</li>
      <li>Flog - 59.9</li>
      <li>Flay - 0</li>
      <li>Tests - 104 examples, 0 failures</li>
    </ul>
  </div>

  <div class='right-column code-font'>
    <h2>New stats</h2>
    <ul>
      <li>LOC - <span class='highlight-red'>77</span></li>
      <li>LOT - 190</li>
      <li>Flog - 59.9</li>
      <li>Flay - 0</li>
      <li>Tests - 104 examples, 0 failures</li>
    </ul>
  </div>

  <aside class='notes' data-markdown>
- metryki nie wszystko wychwycą
- to my mamy myśleć
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <h2 class='font-size-like-h1'>Step 6 - More descriptive output</h2>
  <img src='./images/egoistic-programmer/blabla.jpg' alt='Bla bla bla' class='pure'>

  <aside class='notes' data-markdown>
- nazywanie rzeczy
  </aside>
</section>

<section data-markdown
         data-transition='slide-in fade-out'>
## Step 6 - More descriptive output

#### Before

```ruby
def check
  return 9 if straight_flush?
  return 8 if four_of_a_kind?
  return 7 if full_house?
  return 6 if flush?
  return 5 if straight?
  return 4 if three_of_a_kind?
  return 3 if two_pair?
  return 2 if one_pair?
  return 1 if high_card?
  return 0
end
```

Notes:
- liczby nie wiele nam mówią
- za każdym razem trzeba sprawdzać
</section>

<section data-markdown
         data-transition='fade-in fade-out'>
## Step 6 - More descriptive output

#### After

```ruby
def check
  return :straight_flush if straight_flush?
  return :four_of_a_kind if four_of_a_kind?
  return :full_house if full_house?
  return :flush if flush?
  return :straight if straight?
  return :three_of_a_kind if three_of_a_kind?
  return :two_pair if two_pair?
  return :one_pair if one_pair?
  return :high_card if high_card?
  return :none
end
```

Notes:
- zmiana testów!!!
</section>

<section data-transition='slide-in fade-out'>
  <div data-markdown>
## BONUS - Meta-programming

#### Add to initializer

```ruby
@order_checking = [
  :straight_flush, :four_of_a_kind, :full_house, :flush,
  :straight, :three_of_a_kind, :two_pair, :one_pair,
  :high_card, :none
]
```
  </div>

  <div class='fragment'
       data-fragment-index='1'
       data-markdown>
#### Code after

```ruby
def check
  @order_checking.each do |name|
    method_name = (name.to_s + '?').to_sym
    return name if send(method_name)
  end
end
```
  </div>

  <aside class='notes'
         data-markdown>
- dodatkowo można jeszcze to uprościć
- meta-programming
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <div class='left-column code-font'>
    <h2>Old stats</h2>
    <ul>
      <li>LOC - <span class='highlight-green'>77</span></li>
      <li>LOT - 190</li>
      <li>Flog - <span class='highlight-green'>59.9</span></li>
      <li>Flay - 0</li>
      <li>Tests - 104 examples, 0 failures</li>
    </ul>
  </div>

  <div class='right-column code-font'>
    <h2>New stats</h2>
    <ul>
      <li>LOC - <span class='highlight-red'>80</span></li>
      <li>LOT - 190</li>
      <li>Flog - <span class='highlight-red'>62.5</span></li>
      <li>Flay - 0</li>
      <li>Tests - 104 examples, 0 failures</li>
    </ul>
  </div>

  <aside class='notes' data-markdown>
- meta-programowanie zwiększa complexity
- nie jest czarno-białe
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <h2 class='font-size-like-h1'>Step 7 - Small object</h2>
  <img src='./images/egoistic-programmer/solid.jpg' alt='SOLID' class='pure'>

  <aside class='notes' data-markdown>
- one class - big responsibility
- done by iteration
- for each method => one class
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <div class='midi-size'
       data-markdown>
## Step 7 - Small object

```ruby
module Poker
  class FourOfAKind
    def initialize(array)
      @array = array.sort
      @figures, @colors = cards_figures_and_colors
      @frequency = cards_frequency.values
    end

    def check
      :four_of_a_kind if @frequency.include?(4)
    end

    private

    def cards_figures_and_colors
      @array.map { |item| [item / 4, item % 4] }.transpose
    end

    def cards_frequency
      @figures.each_with_object(Hash.new(0)) do |item, hash|
        hash[item] += 1
      end
    end
  end
end
```
  </div>

  <aside class='notes'
         data-markdown>
Notes:
- Move logic to separate class
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <div data-markdown class='no-max-height'>
## Step 7 - Small object

#### Create/modify `if` statement

```ruby
def check
  @order_checking.each do |name|
    if name == :four_of_a_kind
      return name if FourOfAKind.new(@array).check == name
    else
      method_name = (name.to_s + '?').to_sym
      return name if send(method_name)
    end
  end
end
```
  </div>

  <aside class='notes' data-markdown>
- używamy klasy zamiast metody
- przenosimy testy
- rozgałęziamy rozwiązanie do czasu zakończenia refaktoringu
- wieloetapowy refaktoring
- trzeba go zakończyć
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <div class='middle-size'
       data-markdown>
## Step 7 - Small object

```ruby
require 'spec_helper'

describe Poker::FourOfAKind do
  [
    [0, 1, 2, 3, 4],
    [4, 5, 6, 0, 7],
    [8, 9, 0, 10, 11],
    [12, 0, 13, 14, 15],
    [0, 16, 17, 18, 19],
    [20, 21, 22, 23, 0].shuffle,
    [24, 25, 26, 27, 0].shuffle,
    [28, 29, 30, 31, 0].shuffle,
    [32, 33, 34, 35, 0].shuffle,
    [36, 37, 38, 39, 0].shuffle
  ].each do |cards|
    it "detects four_of_a_kind for #{cards}" do
      hand = described_class.new(cards)
      expect(hand.check).to eq :four_of_a_kind
    end
  end
end
```
  </div>

  <aside class='notes' data-markdown>
Repeat:
1. Move logic to separate class
2. Create/modify `if` statement
3. Prepare tests for new class

- Prepare tests for new class
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <div class='left-column code-font'>
    <h2>Old stats</h2>
    <ul>
      <li>LOC - <span class='highlight-green'>80</span></li>
      <li>LOT - <span class='highlight-red'>190</span></li>
      <li>Flog - <span class='highlight-green'>62.5</span></li>
      <li>Flay - 0</li>
      <li>Tests - 104 examples, 0 failures</li>
    </ul>
  </div>

  <div class='right-column code-font'>
    <h2>New stats</h2>
    <ul>
      <li>LOC - <span class='highlight-red'>85</span></li>
      <li>LOT - <span class='highlight-green'>200</span></li>
      <li>Flog - <span class='highlight-red'>65.5</span></li>
      <li>Flay - 0</li>
      <li>Tests - 116 examples, 0 failures</li>
    </ul>
  </div>

  <aside class='notes' data-markdown>
- calculation only for `Hand` class
- more steps of refactoring (not cover by presentation)
- removing more and more duplication
- add missing test cases
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <div class='left-column code-font'>
    <h2>First stats</h2>
    <ul>
      <li>LOC - <span class='highlight-red'>194</span></li>
      <li>LOT - <span class='highlight-red'>168</span></li>
      <li>Flog - <span class='highlight-red'>112.8</span></li>
      <li>Flog total - <span class='highlight-green'>112.8</span></li>
      <li>Flay - <span class='highlight-red'>123</span></li>
      <li>Tests - 12 examples, 0 failures</li>
    </ul>
  </div>

  <div class='right-column code-font'>
    <h2>Last stats</h2>
    <ul>
      <li>LOC - <span class='highlight-green'>37</span></li>
      <li>LOT - <span class='highlight-green'>173</span></li>
      <li>Flog - <span class='highlight-green'>28.0</span></li>
      <li>Flog total- <span class='highlight-red'>182.4</span></li>
      <li>Flay - <span class='highlight-green'>0</span></li>
      <li>Tests - 145 examples, 0 failures</li>
    </ul>
  </div>

  <aside class='notes' data-markdown>
- kod podzielony na małe klocki
- złożoność klas zmalała
- złożoność systemu wzrosła
- dużo małych klas
- łatwe do zastąpienia
- operujemy na konwencji (konwencja ponad konfigurację)
- kod łatwy z poziomu rozszerzalności
  </aside>
</section>


<section data-transition='slide-in fade-out'>
  <h2 class='font-size-like-h1'>Rules & Examples</h2>

  <aside class='notes' data-markdown>
- wyciągnijmy z tego proste techniki refaktoringu
- proste i szybkie sposoby na poprawę kodu
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <h2 class='font-size-like-h1'>Names with meaning</h2>
  <img src='./images/egoistic-programmer/meaning.jpg' alt='Name with meaning' class='one-size pure'>

  <aside class='notes' data-markdown>
  </aside>
</section>

<section data-transition='fade-in fade-out'>
  <h4 class='font-size-like-h1'>Names with meaning</h4>

  <div data-markdown>
```ruby
n12
n1n2
```
  </div>

  <aside class='notes' data-markdown>
- podobnie wyglądają
- może ktoś się pomylił?
- co to może oznaczać?
  </aside>
</section>

<section data-transition='fade-in fade-out'>
  <h4 class='font-size-like-h1'>Names with meaning</h4>

  <div data-markdown>
```ruby
n12 = n1 ^ 2
n1n2 = n1 * n2
```
  </div>

  <aside class='notes' data-markdown>
- są to dwie różne zmienne
- co to może oznaczać?
- nitrogen
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <h4 class='font-size-like-h1'>Names with meaning</h4>
  <div data-markdown>
```ruby
field_ids
```
  </div>
  <div class='fragment fade-in-then-semi-out' data-fragment-index='1'>
    <div data-markdown>
#### Bad
```ruby
field_ids = Field.pluck(:number)
```
    </div>
  </div>
  <div class='fragment' data-fragment-index='2'>
    <div data-markdown>
#### Good
```ruby
field_ids = Field.pluck(:id)
```
    </div>
  </div>

  <aside class='notes' data-markdown>
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <h2 class='font-size-like-h1'>Simple conditions/logic</h2>
  <img src='./images/egoistic-programmer/simple.jpg' alt='Simplicity' class=' one-size pure'>

  <aside class='notes' data-markdown>
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <h4 class='font-size-like-h1'>Simple conditions/logic</h4>

  <div data-markdown>
```javascript
if (this.isContext && !item.hasContextId) {} else {
  // more logic here
}
```
  </div>

  <aside class='notes' data-markdown>
- javascript
- pusta logika gdy warunek spełniony
- wszystko dzieje się w else
- można tego else nie zauważyc i myśleć że to się wykonuje gdy warunek spełniony
- zaprzeczyć warunkowi
- otoczyć ten warunek metodą
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <h2 class='font-size-like-h1'>KISS, DRY and Rock & Roll</h2>

  <img src='./images/egoistic-programmer/fractalsoft-kiss-dry.jpg' alt='KISS, DRY and Rock & Roll' class='pure' style='width: 30%;'>

  <aside class='notes' data-markdown>
  </aside>
</section>

<section data-transition='fade-in fade-out'>
  <h4 class='font-size-like-h1'>What does this code?</h4>
  <div style='visibility: hidden;'>
    <div data-markdown>
```basic
m1 = 2
```
    </div>
  </div>

  <div data-markdown>
```basic
For i = 1 To m1
For j = 1 To m1
If i <> j Then
s3(i, j) = 0
GoTo 410
End If
s3(i, j) = 1
410 Next j
Next i
```
  </div>

  <aside class='notes' data-markdown>
- Visual Basic
- co to robi?
- nie ma wcięć / formatowania
  </aside>
</section>

<section data-transition='fade-in fade-out'>
  <h4 class='font-size-like-h1'>Is it helpful?</h4>
  <div class='fragment' data-fragment-index='1'>
    <div data-markdown>
```basic
m1 = 2
```
    </div>
  </div>

  <div data-markdown>
```basic
For i = 1 To m1
  For j = 1 To m1
    If i <> j Then
      s3(i, j) = 0
      GoTo 410
    End If
    s3(i, j) = 1
  410 Next j
Next i
```
  </div>

  <aside class='notes' data-markdown>
- zastosowanie wcięć
- przeklęte goto
- czy to pomaga?
- a może informacja o `m1 = 2` pomoże
- czy to nie dziwne, że ten kod to po prostu
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <h4 class='font-size-like-h1'>Solution 1</h4>
  <div data-markdown>
```ruby
array = [
  [1, 0],
  [0, 1]
]
```
  </div>

  <div class='fragment' data-fragment-index='1'>
    <h4 class='font-size-like-h1'>Solution 2</h4>
    <div data-markdown>
```basic
For i = 1 To m1
  For j = 1 To m1
    If i <> j Then s3(i, j) = 0
    If i = j Then s3(i, j) = 1
  Next j
Next i
```
    </div>
  </div>

  <aside class='notes' data-markdown>
- macierz jednostkowa 2x2
- jeżeli chcielibyśmy tworzyć macierze jednostkowe dowolnej wielkości
- zapisać te pętle i jeszcze otoczyć to nazwą metody
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <h3 class='font-size-like-h1'>More and more rules...</h3>

  <aside class='notes' data-markdown>
- zasad jest wiele
- często mówią o tym samym, na różne sposoby
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <h2 class='font-size-like-h1'>Write clean code</h2>

  <aside class='notes' data-markdown>
- na co dzień pisz czysty, prosty kod
- Ty sam sobie podziękujesz i inni też
- więcej czasu spędzamy na czytaniu kodu niż jego pisaniu
- stosowanie dobrych praktyk jest dobrą praktyką (meta złota myśl)
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <h2 class='font-size-like-h1'>Small things matter</h2>

  <aside class='notes' data-markdown>
- jedna rzecz do zapamiętania
- małe rzeczy mają znaczenie
  </aside>
</section>

<section data-transition='slide-in fade-out'>
  <h2 class='font-size-like-h1'>Are you an Egoistic Programmer?</h2>

  <aside class='notes' data-markdown>
- pytam jeszcze raz
- czy chcesz być egoistycznym programistą i ułatwić sobie życie
  </aside>
</section>

<!--

# Poker cards

<table class='table'>
  <tbody>
    <tr>
      <td>0 </td> <td>2&spades;</td>
      <td>4 </td> <td>3&spades;</td>
      <td>8 </td> <td>4&spades;</td>
      <td>12</td> <td>5&spades;</td>
      <td>16</td> <td>6&spades;</td>
      <td>20</td> <td>7&spades;</td>
      <td>24</td> <td>8&spades;</td>
    </tr>
    <tr>
      <td>1 </td> <td>2&clubs;</td>
      <td>5 </td> <td>3&clubs;</td>
      <td>9 </td> <td>4&clubs;</td>
      <td>13</td> <td>5&clubs;</td>
      <td>17</td> <td>6&clubs;</td>
      <td>21</td> <td>7&clubs;</td>
      <td>25</td> <td>8&clubs;</td>
    </tr>
    <tr>
      <td>2 </td> <td class='red'>2&hearts;</td>
      <td>6 </td> <td class='red'>3&hearts;</td>
      <td>10</td> <td class='red'>4&hearts;</td>
      <td>14</td> <td class='red'>5&hearts;</td>
      <td>18</td> <td class='red'>6&hearts;</td>
      <td>22</td> <td class='red'>7&hearts;</td>
      <td>26</td> <td class='red'>8&hearts;</td>
    </tr>
    <tr>
      <td>3 </td> <td class='red'>2&diams;</td>
      <td>7 </td> <td class='red'>3&diams;</td>
      <td>11</td> <td class='red'>4&diams;</td>
      <td>15</td> <td class='red'>5&diams;</td>
      <td>19</td> <td class='red'>6&diams;</td>
      <td>23</td> <td class='red'>7&diams;</td>
      <td>27</td> <td class='red'>8&diams;</td>
    </tr>
  </tbody>
</table>

<br>

<table class='table'>
  <tbody>
    <tr>
      <td>28</td> <td>9&spades;</td>
      <td>32</td> <td>10&spades;</td>
      <td>36</td> <td>J&spades;</td>
      <td>40</td> <td>D&spades;</td>
      <td>44</td> <td>K&spades;</td>
      <td>48</td> <td>A&spades;</td>
    </tr>
    <tr>
      <td>29</td> <td>9&clubs;</td>
      <td>33</td> <td>10&clubs;</td>
      <td>37</td> <td>J&clubs;</td>
      <td>41</td> <td>D&clubs;</td>
      <td>45</td> <td>K&clubs;</td>
      <td>49</td> <td>A&clubs;</td>
    </tr>
    <tr>
      <td>30</td> <td class='red'>9&hearts;</td>
      <td>34</td> <td class='red'>10&hearts;</td>
      <td>38</td> <td class='red'>J&hearts;</td>
      <td>42</td> <td class='red'>D&hearts;</td>
      <td>46</td> <td class='red'>K&hearts;</td>
      <td>50</td> <td class='red'>A&hearts;</td>
    </tr>
    <tr>
      <td>31</td> <td class='red'>9&diams;</td>
      <td>35</td> <td class='red'>10&diams;</td>
      <td>39</td> <td class='red'>J&diams;</td>
      <td>43</td> <td class='red'>D&diams;</td>
      <td>47</td> <td class='red'>K&diams;</td>
      <td>52</td> <td class='red'>A&diams;</td>
    </tr>
  </tbody>
</table>

 -->

<section data-markdown
         data-transition='slide-in fade-out'>
  <script type='text/template'>
### Books
- [The Pragmatic Programmer: From Journeyman to Master - Andrew Hund, David Thomas](https://helion.pl/view/10301k/pragpv.htm#format/d)
- [Practical Object-Oriented Design in Ruby: An Agile Primer - Sandi Metz](https://www.amazon.com/Practical-Object-Oriented-Design-Ruby-Addison-Wesley/dp/0321721330)
- [Clean Code: A Handbook of Agile Software Craftsmanship - Robert C. Martin](https://helion.pl/view/10301k/czykov.htm#format/d)
- [Test Driven Development: By Example - Ken Beck](https://helion.pl/view/10301k/tddszt.htm#format/d)
- [Design Patterns in Ruby - Russ Olsen](https://helion.pl/view/10301k/rubywz.htm#format/d)
  </script>
</section>

<section data-markdown>
  <script type='text/template'>
### Presentations
- [All the Little Things by Sandi Metz](https://www.youtube.com/watch?v=8bZh5LMaSmE)
- [Nothing is Something by Sandi Metz](https://www.youtube.com/watch?v=OMPfEXIlTVE)
- [Best Ruby on Rails refactoring talks](https://infinum.co/the-capsized-eight/best-ruby-on-rails-refactoring-talks)
  </script>
</section>

<section data-markdown>
  <script type='text/template'>
### Bibliography
- [Poker code - refactoring](https://github.com/womanonrails/poker)
- [The Gilded Rose Code Kata](https://github.com/jimweirich/gilded_rose_kata)
- [List of poker hands](https://en.wikipedia.org/wiki/List_of_poker_hands)
- [Don't repeat yourself](https://en.wikipedia.org/wiki/Don%27t_repeat_yourself)
- [KISS](https://en.wikipedia.org/wiki/KISS_principle)
- [SOLID](https://en.wikipedia.org/wiki/SOLID_%28object-oriented_design%29)
  </script>
</section>

</section>

<section class='pull-right last-section' data-background='images/shared/unicorn-agnieszka.jpg'>
  <img alt='Woman on Rails logotype' class='pure' data-src='images/womanonrails.png' height='94' width='300'>
  <h2 class='author-name'>Agnieszka Małaszkiewicz</h2>
  <p class='author-mail'>agnieszka (at) fractalsoft (dot) org</p>

  <div class='links'>
    <p>
      <a href='https://womanonrails.com/' target='_blank' title='Web development from woman perspective'>
        WomanOnRails.com
      </a>
    </p>
    <p>
      <a href='https://twitter.com/womanonrails' rel='nofollow noopener' target='_blank' title='Twitter @womanonrails'>
        <span class='zocial-twitter'></span> @womanonrails
      </a>
    </p>
    <p>
      <a href='https://fractalsoft.org/pl' target='_blank' title='Programiści Ruby on Rails i JavaScript'>
        <span>
          <img alt='Fractal Soft logo' class='pure' data-src='images/icons/svg/fractalsoft.svg' style='width: 30px;'>
          Fractal Soft
        </span>
      </a>
    </p>
  </div>

  <p class='social'>
    <a href='https://github.com/womanonrails' rel='nofollow noopener' target='_blank' title='GitHub'>
      <span class='zocial-github'></span>
    </a>
    <a href='https://www.instagram.com/womanonrails' rel='nofollow noopener' target='_blank' title='Instagram'>
      <span class='zocial-instagram'></span>
    </a>
    <a href='https://www.facebook.com/107403177317825/' rel='nofollow noopener' target='_blank' title='Facebook'>
      <span class='zocial-facebook'></span>
    </a>
    <a href='https://www.youtube.com/@womanonrails' rel='nofollow noopener' target='_blank' title='YouTube'>
      <span class='zocial-youtube'></span>
    </a>
    <a href='https://vimeo.com/womanonrails' rel='nofollow noopener' target='_blank' title='Vimeo'>
      <span class='zocial-vimeo'></span>
    </a>
  </p>
</section>

      </div>
    </div>

    <script src='js/reveal.js'></script>

    <script>
      // More info about config & dependencies:
      // - https://github.com/hakimel/reveal.js#configuration
      // - https://github.com/hakimel/reveal.js#dependencies
      Reveal.initialize({
        // Transition style for full page slide backgrounds
        backgroundTransition: 'fade', // none/fade/slide/convex/concave/zoom

        // Vertical centering of slides
        center: true,

        // Display presentation control arrows
        controls: false,

        // Visibility rule for backwards navigation arrows; "faded", "hidden" or "visible"
        controlsBackArrows: 'faded',

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: 39,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL, so that reloading brings you to the same fragment position
        fragmentInURL: true,

        // Flags if we should show a help overlay when the questionmark key is pressed
        help: true,

        // Hides the address bar on mobile devices
        hideAddressBar: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Loop the presentation
        loop: false,

        // Enable slide navigation via mouse wheel
        mouseWheel: true,

        // Enable the slide overview mode
        overview: true,

        // Display a presentation progress bar
        progress: false,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Display the page number of the current slide
        slideNumber: true,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Transition style
        transition: 'slide', // none/fade/slide/convex/concave/zoom

        // Transition speed
        transitionSpeed: 'default', // default/fast/slow

        // Number of slides away from the current that are visible
        viewDistance: 3,

        dependencies: [
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/search/search.js', async: true },
          { src: 'plugin/zoom-js/zoom.js', async: true },
          { src: 'plugin/notes/notes.js', async: true }
        ]
      });
    </script>
  </body>
</html>
